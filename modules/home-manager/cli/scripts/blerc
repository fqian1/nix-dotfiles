# https://github.com/akinomyoga/ble.sh/blob/master/blerc.template

## -- Main Options --
bleopt prompt_eol_mark=
bleopt exec_errexit_mark=
bleopt exec_elapsed_enabled='sys+usr>=5*60*1000'
bleopt_prompt_command_changes_layout=1

ble-bind -m vi_imap -f 'C-m' accept-line
ble-bind -m vi_nmap -f 'RET' accept-line
ble-bind -m vi_imap -f 'RET' accept-line
ble-bind -m vi_nmap -f 'C-m' accept-line

ble-bind -m vi_nmap --cursor 2
ble-bind -m vi_imap --cursor 5
ble-bind -m vi_omap --cursor 4
ble-bind -m vi_xmap --cursor 2
ble-bind -m vi_cmap --cursor 0

function my/vim-load-hook {
  bleopt keymap_vi_mode_string_nmap=$'\e[1m-- NORMAL --\e[m'
}
blehook/eval-after-load keymap_vi my/vim-load-hook

## -- Map colours to base16 --

ble-face -s argument_error            'fg=1,underline'
ble-face -s argument_option           'fg=3'
ble-face -s auto_complete             'fg=0,bg=7'
ble-face -s cmdinfo_cd_cdpath         'fg=4,bg=3'
ble-face -s command_directory         'fg=4,underline'
ble-face -s command_function          'fg=5'
ble-face -s command_builtin_dot       'fg=5,bold'
ble-face -s command_builtin           'fg=5'
ble-face -s command_alias             'fg=5'
ble-face -s command_file              'fg=5'
ble-face -s command_keyword           'fg=5'
ble-face -s command_jobs              'fg=5'
ble-face -s disabled                  'fg=8'
ble-face -s filename_directory        'fg=4,underline'
ble-face -s filename_directory_sticky 'fg=15,bg=4,underline'
ble-face -s filename_orphan           'fg=6,bg=13,underline'
ble-face -s filename_setgid           'fg=0,bg=2,underline'
ble-face -s filename_setuid           'fg=0,bg=3,underline'
ble-face -s filename_link             'fg=6,underline'
ble-face -s filename_executable       'fg=6,underline'
ble-face -s filename_other            'fg=6,underline'
ble-face -s filename_socket           'fg=6,underline'
ble-face -s filename_pipe             'fg=6,underline'
ble-face -s filename_character        'fg=6,underline'
ble-face -s filename_block            'fg=6,underline'
ble-face -s filename_warning          'fg=6,underline'
ble-face -s filename_url              'fg=6,underline'
ble-face -s filename_ls_colors        'fg=6,underline'
ble-face -s overwrite_mode            'fg=0,bg=6'
ble-face -s prompt_status_line        'fg=15,bg=8'
ble-face -s region                    'fg=15,bg=12'
ble-face -s region_insert             'fg=4,bg=7'
ble-face -s region_match              'fg=15,bg=12'
ble-face -s region_target             'fg=0,bg=6'
ble-face -s syntax_brace              'fg=6,bold'
ble-face -s syntax_command            'fg=5'
ble-face -s syntax_comment            'fg=8'
ble-face -s syntax_default            'none'
ble-face -s syntax_document           'fg=3'
ble-face -s syntax_document_begin     'fg=3,bold'
ble-face -s syntax_error              'fg=15,bg=1'
ble-face -s syntax_expr               'fg=4'
ble-face -s syntax_function_name      'fg=5,bold'
ble-face -s syntax_glob               'fg=5,bold'
ble-face -s syntax_history_expansion  'fg=15,bg=13'
ble-face -s syntax_param_expansion    'fg=5'
ble-face -s syntax_tilde              'fg=4,bold'
ble-face -s syntax_varname            'fg=3'
ble-face -s syntax_quoted             'fg=4'
ble-face -s syntax_quotation          'fg=4,bold'
ble-face -s syntax_escape             'fg=4'
ble-face -s syntax_delimiter          'fg=4,bold'
ble-face -s varname_array             'fg=3,bold'
ble-face -s varname_empty             'fg=6'
ble-face -s varname_export            'fg=5,bold'
ble-face -s varname_expr              'fg=4,bold'
ble-face -s varname_hash              'fg=2,bold'
ble-face -s varname_number            'fg=11'
ble-face -s varname_readonly          'fg=5'
ble-face -s varname_transform         'fg=6,bold'
ble-face -s varname_unset             'fg=8'
ble-face -s vbell_erase               'bg=8'

## -- Integrations --

ble-import integration/nix-completion

## -- Prompt --
ble-import contrib/prompt-git

function ble/prompt/backslash:cwd2 {
  local dir="${PWD##*/}"
  local pdir_full="${PWD%/*}"
  local pdir="${pdir_full##*/}"
  local pdirt="${pdir:0:3}.."

  if [[ "$PWD" == "$HOME" ]]; then
    ble/prompt/print "~"
  elif [[ "$PWD" == "/" ]]; then
    ble/prompt/print "/"
  elif [[ -z "$pdir_full" ]]; then # Checks if PWD is / (which is already covered, but good for completeness)
    ble/prompt/print "$dir"
  elif [[ "$pdir_full" == "$HOME" ]]; then
    ble/prompt/print "~/$dir" # Check if the full parent path is HOME
  else
    ble/prompt/print "$pdirt/$dir"
  fi
}

show_direnv() {
  if [[ -n "$DIRENV_DIR" ]]; then
    echo "(nix) "
  fi
}

export PS1='$(show_direnv)'$PS1

PS1='\g{fg=2}[\u@\h:\q{cwd2}]\g{fg=2}\q{contrib/git-branch}\g{fg=2}\$ \g{none}'
bleopt prompt_rps1='\q{contrib/git-hash} \g{bg=0}\t\g{none}'
